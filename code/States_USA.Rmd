---
title: "R Notebook"
output: html_notebook
---


```{r}

```


```{r}
library(readxl)
extremist_data <- read_excel("/Users/laurabazzigher/Desktop/Soziologie_Faschismus/Sociolgy.xlsx")
head(extremist_data)
str(extremist_data)
```

```{r}
library(tidyr)
library(dplyr)

extremist_data <- extremist_data %>%
  separate_rows(Group, sep = "/")
```

```{r}
total_groups <- length(unique(extremist_data$Group))
total_groups
```

```{r}
groups_per_state <- extremist_data %>%
  group_by(State) %>%
  summarise(Count = n_distinct(Group))
groups_per_state
```

```{r}
# Laden der benötigten Libraries
library(dplyr)

# Daten nach 'Group' gruppieren und die Anzahl der einzigartigen 'State' zählen
group_states_count <- extremist_data %>%
  group_by(Group) %>%
  summarise(States_Count = n_distinct(State))

# Ausgabe der Ergebnisse
group_states_count
```

```{r}
# Laden der benötigten Libraries
library(dplyr)
library(ggplot2)
library(maps)

# Daten für die Kartenvisualisierung vorbereiten
group_counts_per_state <- extremist_data %>%
  group_by(State) %>%
  summarise(Group_Count = n_distinct(Group))

# Kartendaten für die USA laden
usa_map <- map_data("state")

# Sicherstellen, dass die Namen der Staaten übereinstimmen (im Kartenformat sind sie klein geschrieben)
group_counts_per_state <- group_counts_per_state %>%
  mutate(State = tolower(State))

# Karte der USA mit Gruppenzählung pro Staat als Heatmap
ggplot() +
  geom_polygon(data = usa_map, aes(x = long, y = lat, group = group),
               fill = "grey90", color = "white") +
  geom_map(data = group_counts_per_state, map = usa_map,
           aes(map_id = State, fill = Group_Count),
           color = "white") +
  scale_fill_gradient(low = "lightblue", high = "darkblue", na.value = "grey90") +
  theme_minimal() +
  labs(title = "Anzahl der Gruppen pro Staat in den USA", fill = "Gruppenanzahl") +
  coord_fixed(1.3)
```


```{r}
# Laden der benötigten Libraries
library(dplyr)
library(tidyr)

# Funktion zur Erstellung der pivotierten Tabelle
create_pivot_table <- function(selected_groups) {
  # Liste aller einzigartigen Staaten und ausgewählten Gruppen erstellen
  all_states <- unique(extremist_data$State)
  
  # Kreuztabelle mit allen Kombinationen von Staaten und ausgewählten Gruppen erstellen
  table_data <- expand.grid(State = all_states, Group = selected_groups) %>%
    left_join(extremist_data, by = c("State", "Group")) %>%
    mutate(
      Represented_in_state = ifelse(is.na(Represented_in_state), 0, as.numeric(Represented_in_state))
    ) %>%
    select(State, Group, Represented_in_state)
  
  # Tabelle pivotieren, sodass die Gruppen als Spalten dargestellt werden
  pivot_table <- table_data %>%
    pivot_wider(names_from = Group, values_from = Represented_in_state, values_fill = 0) %>%
    arrange(State)
  
  return(pivot_table)
}

# Beispiel: Tabelle für spezifische Gruppen "One Truth", "Proud Boys" und andere erstellen
pivot_table <- create_pivot_table(c("One Truth", "Proud Boys", "Moms for Liberty", "Active Club"))

# Ausgabe der Tabelle
knitr::kable(pivot_table)
```



```{r}
library(tidycensus)
# census_api_key("2d3f261fc73b35cf4c47a1a16a2449d794b242bb", install = TRUE)
```

```{r}
library(tidycensus)
library(dplyr)

# Abrufen der Bevölkerungsdaten ohne Filter
population_data <- get_estimates(
  geography = "state",
  product = "population",
  vintage = 2022,  # Setzt das Jahr 2022 als Bezugsjahr fest
  year = 2022
)

# Ausgabe der ersten Zeilen und Spaltennamen, um die Daten zu überprüfen
head(population_data)
str(population_data)
```


# Bevölkerungsdaten der Bundesstaaten abrufen und auf die Bevölkerungsschätzung filtern
```{r}
population_data <- get_estimates(
  geography = "state",
  product = "population",
  vintage = 2022,
  year = 2022
) %>%
  filter(variable == "POPESTIMATE") %>%  # Filtern auf "POPESTIMATE"
  select(NAME, value) %>%
  rename(State = NAME, Population = value)

# Ausgabe der Daten
head(population_data)
```
# Laden der Variablenliste für den ACS 5-Jahres-Datensatz von 2022
```{r}
variables <- load_variables(2022, "acs5", cache = TRUE)
variables
```

